<?php
// get plugin data
$plugData = get_plugin_data(WPASL_PLUGIN_DIR.'advanced-security-logger-by-pentest7.php');


// save plugin settings
if(sanitize_text_field(isset($_POST["btnSaveChanges"])))
{
    update_option('wpasl-hide-login',sanitize_text_field($_POST['wpasl-hide-login']));
    update_option('wpasl-login-slug',sanitize_text_field($_POST['wpasl-login-slug']));
    update_option('wpasl-front-logging',sanitize_text_field($_POST['wpasl-front-logging']));
    update_option('wpasl-admin-logging',sanitize_text_field($_POST['wpasl-admin-logging']));
    update_option('wpasl-log-perpage',$_POST['wpasl-log-perpage']);

    update_option('wpasl-alert-logging',sanitize_text_field($_POST['wpasl-alert-logging']));
    update_option('wpasl-alert-emails',sanitize_text_field($_POST['wpasl-alert-emails']));
    update_option('wpasl-sus-urls',sanitize_text_field($_POST['wpasl-sus-urls']));
    update_option('wpasl-sus-ips',sanitize_text_field($_POST['wpasl-sus-ips']));

    if(esc_html($_POST['wpasl-log-days'])=='')
    {
        update_option('wpasl-log-days',30);
    }
    else
    {
        update_option('wpasl-log-days',sanitize_text_field($_POST['wpasl-log-days']));
    }
}

// load current options value
$opts = [];
$current_user_email             = wp_get_current_user()->user_email;
$opts['wpasl-hide-login']       = get_option('wpasl-hide-login', false);
$opts['wpasl-login-slug']       = get_option('wpasl-login-slug', false);
$opts['wpasl-front-logging']    = get_option('wpasl-front-logging', false);
$opts['wpasl-admin-logging']    = get_option('wpasl-admin-logging', false);
$opts['wpasl-log-perpage']      = get_option('wpasl-log-perpage', 20);
$opts['wpasl-log-days']         = get_option('wpasl-log-days', 30);
$opts['wpasl-alert-logging']    = get_option('wpasl-alert-logging', false);
$opts['wpasl-alert-emails']     = get_option('wpasl-alert-emails', $current_user_email);
$opts['wpasl-sus-urls']         = get_option('wpasl-sus-urls', "");
$opts['wpasl-sus-ips']          = get_option('wpasl-sus-ips', "");
?>
<div class="wpasl-page">
    <div class="wpasl-page-inner">
        <div class="wpasl-options wpasl-dashboard">
            <div class="wpasl-options-form">
                <h2></h2>
                <div class="wpasl-options-header">
                    <div class="wpasl-options-theme-data">
                        <h2 class="wpasl-options-theme-name">
                            <?php echo esc_attr($plugData['Name']) ?>
                        </h2>
                        <span class="wpasl-options-theme-version">
                            <?php echo esc_attr('V'.$plugData['Version'])?>
                        </span>
                    </div>
                </div>
                <form action="" method="post">
                    <input type="hidden" name="active_tab" value="<?php echo esc_html(isset($_POST["active_tab"])) ? esc_html($_POST["active_tab"]) : ""?>" />
                    <div class="wpasl-fields-tabs">
                        <div class="wpasl-sections-nav">
                            <?php require_once "inc/settings_tab_heads.php"; ?>
                        </div>
                        <div class="wpasl-sections">
                            <br/>
                            <center><a href="https://pentest7.io"><img src="https://pentest7.io/banner.gif" width="100%"></a></center>
                            <?php require_once "inc/tabs.php"; ?>
                            <div id="popup_this" style="display: none;">
                                <span class="button b-close">
                                    <span>Close</span>
                                </span>
                                <h3>Did you know more than 60% of companies close within 6 months of being hacked?</h3>
                                <p>At <b>Pentest7</b> we help companies to secure their applications online.</p>
                                <br/>
                                <span><a href="https://pentest7.io">Contact Us</a></span>

                            </div>

                            <div class="wpasl-options-actions">
                                <button type="submit" name="btnSaveChanges" class="wpasl-save-options-btn wpasl-btn wpasl-btn-primary">
                                    Save options
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
